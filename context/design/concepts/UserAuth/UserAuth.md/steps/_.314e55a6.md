---
timestamp: 'Sat Oct 18 2025 12:14:00 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251018_121400.1a141114.md]]'
content_id: 314e55a6b96b3d3372acbe01edf2b391a3303346c388188d48b4d43137925e3c
---

# UserAuth Concept

[text](../../../context/design/brainstorming/questioning.md/steps/response.b80891d5.md)

concept UserAuth \[User]
purpose authenticate users and manage moderator privileges
principle users must register and log in before contributing; moderators can verify content

state
a set of Users with
an \_id Id                   // Added explicit userId
a username String
a passwordHash String
a canModerate Flag

a set of activeSessions with
a sessionToken String
an \_id Id

actions
registerUser (username: String, password: String) : (userId: Id | Error)
requires username unique and password non-empty
effect creates a new user with default permissions (cannot moderate), returns userId on success or an Error on failure (e.g., username taken).

login (username: String, password: String) : (sessionToken: String | Error)
requires username exists and password matches
effect creates a new active session, returns a new unique sessionToken on success. Returns an Error (e.g., "Invalid credentials") on failure.

logout (sessionToken: String) : (success: Boolean)
requires sessionToken exists in activeSessions
effect removes the sessionToken from activeSessions, returns true on success, false otherwise.

getAuthenticatedUser (sessionToken: String) : (userProfile: {userId: Id, username: String, canModerate: Flag} | null)
requires sessionToken is valid and exists in activeSessions
effect returns a subset of user information for the authenticated user, or null if sessionToken is invalid.

changePassword (sessionToken: String, oldPassword: String, newPassword: String) : (success: Boolean | Error)
requires sessionToken is valid and linked to a user, oldPassword matches the user's current passwordHash, and newPassword is non-empty.
effect updates the passwordHash for the authenticated user, invalidates existing sessionTokens (optional but good security), returns true on success, or an Error on failure.

grantModerator (targetUserId: Id, adminSessionToken: String) : (success: Boolean | Error)
requires adminSessionToken is valid and linked to a user whose canModerate is true, and targetUserId exists.
effect sets canModerate to true for targetUser, returns true on success, or an Error on failure.

revokeModerator (targetUserId: Id, adminSessionToken: String) : (success: Boolean | Error)
requires adminSessionToken is valid and linked to a user whose canModerate is true, and targetUserId exists.
effect sets canModerate to false for targetUser, returns true on success, or an Error on failure.
